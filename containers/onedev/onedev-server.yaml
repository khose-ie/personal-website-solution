version: "3"

services:
    onedev-server-backup:
        image: 1dev/server:7.2.5
        container_name: website-onedev-server-backup
        entrypoint: tar
        command:
            - -zcf
            - /root/backup/onedev-server-backup.tar.gz
            - -C/opt/onedev/
            - conf
            - site
        volumes:
            - onedev-server:/opt/onedev
            - $BASE_PATH/backup:/root/backup
        networks:
            - onedev

    onedev-server-restore:
        image: 1dev/server:7.2.5
        container_name: website-onedev-server-restore
        entrypoint: tar
        command:
            - -zxf
            - /root/backup/onedev-server-backup.tar.gz
            - -C/opt/onedev/
        volumes:
            - onedev-server:/opt/onedev
            - $BASE_PATH/backup:/root/backup
        networks:
            - onedev

networks:
    onedev:
        name: website-onedev

volumes:
    onedev-server:
        name: website-onedev-server

    nginx-confd:
        name: website-nginx-confd
        external: true
